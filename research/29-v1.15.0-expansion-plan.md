# CrossFin v1.15.0 수정계획서

> 작성일: 2026-02-24
> 현재 버전: v1.14.0
> 목표 버전: v1.15.0
> 이전 논의: ses_375bc5745ffeUeX7dqJ9fBpraC (2026-02-23)

---

## 1. 배경

2026-02-23 세션에서 CrossFin의 확장 방향을 4가지로 논의했다:

1. **새 거래소**: Coinbase + Jupiter DEX
2. **새 브릿지 코인**: SUI + APT (Aptos)
3. **TON 생태계 통합**
4. **홍콩 거래소**: HashKey + OSL

이후 기술/법적 검토를 거쳐 아래와 같이 확정한다.

---

## 2. 확정 범위

### ✅ 진행

| 항목 | 설명 |
|------|------|
| **Coinbase (14번째 거래소)** | Global CEX 추가. Public API (인증 불필요), 1회 호출로 전체 SPOT 가격 조회. |
| **SUI 브릿지 코인 (12번째)** | 13개 중 12개 거래소 지원 (GoPax 제외). 서브초 파이널리티. |
| **APT 브릿지 코인 (13번째)** | 13개 중 10개 거래소 지원 (GoPax, bitFlyer, bitbank 제외). 서브초 파이널리티. |

### ⛔ 보류/제외

| 항목 | 판정 | 사유 |
|------|------|------|
| **Jupiter DEX** | ⛔ 보류 | DEX는 입출금/수탁 개념이 없어 라우팅 모델(A거래소 매수→출금→B거래소 입금→매도)에 부적합. API키 필요. SUI가 솔라나에 네이티브로 없음. |
| **TON** | ⚠️ 보류 | 유저 지시: "추측이야 팩트야?" — 규제 불확실성(Durov 건) 존재. 기술적으로는 가능하나 별도 검토 후 결정. |
| **HashKey/OSL** | ❌ 제외 | 유저 지시: "기술적으로 안되면 빼." Public API 부재, 라이센스 거래소 접근 제한. |

---

## 3. 기술 리서치 결과

### 3.1 Coinbase API

- **엔드포인트**: `GET https://api.coinbase.com/api/v3/brokerage/market/products?product_type=SPOT&get_all_products=true`
- **인증**: 불필요 (Public endpoint)
- **응답 형태**:
  ```json
  {
    "products": [
      {
        "product_id": "BTC-USD",
        "price": "64589.85",
        "base_currency_id": "BTC",
        "quote_currency_id": "USD",
        "status": "online",
        "trading_disabled": false
      }
    ],
    "num_products": 878
  }
  ```
- **Rate Limit**: 10 req/s (public). `get_all_products=true`로 1회 호출이면 충분.
- **코인 커버리지**: BTC, ETH, XRP, SOL, DOGE, ADA, DOT, LINK, AVAX, SUI, APT 지원. **TRX, KAIA 미지원.**
- **거래 수수료**: 0.60% taker / 0.40% maker (기본 티어). 라우팅 config에는 **0.50%** 사용.
- **출금 수수료**: 동적 (네트워크 기반), 고정 테이블 없음. 보수적 추정치 사용.

### 3.2 SUI 거래소 지원 현황

| 거래소 | 지원 | 페어 | 출금 수수료 |
|--------|------|------|------------|
| Bithumb | ✅ | SUI/KRW | 0.06 SUI |
| Upbit | ✅ | SUI/KRW | 0.06 SUI |
| Coinone | ✅ | SUI/KRW | 1.0 SUI (높음) |
| GoPax | ❌ | — | — |
| bitFlyer | ❌ | — | — |
| WazirX | ✅ | SUI/INR | 0.06 SUI |
| bitbank | ✅ | SUI/JPY | 0.06 SUI |
| Indodax | ✅ | SUI/IDR | 0.06 SUI |
| Bitkub | ✅ | SUI/THB | 0.06 SUI |
| Binance | ✅ | SUI/USDT | 0.06 SUI |
| OKX | ✅ | SUI/USDT | 0.06 SUI |
| Bybit | ✅ | SUI/USDT | 0.02 SUI |
| KuCoin | ✅ | SUI/USDT | 0.26 SUI |
| **Coinbase** | ✅ | SUI/USD | 동적 |

- **체인 파이널리티**: Mysticeti v2 — 400~500ms (서브초)
- **실전 전송 시간**: ~1분 (거래소 처리 포함)
- **현재 가격**: ~$1.57

### 3.3 APT 거래소 지원 현황

| 거래소 | 지원 | 페어 | 출금 수수료 |
|--------|------|------|------------|
| Bithumb | ✅ | APT/KRW | 0.01 APT |
| Upbit | ✅ | APT/KRW | 0.0054 APT (확인됨) |
| Coinone | ✅ | APT/KRW | 0.02 APT |
| GoPax | ❌ | — | — |
| bitFlyer | ❌ | — | — |
| WazirX | ✅ | APT/INR | 0.02 APT |
| bitbank | ❌ | — | — |
| Indodax | ✅ | APT/IDR | 0.02 APT |
| Bitkub | ✅ | APT/THB | 0.02 APT |
| Binance | ✅ | APT/USDT | 0.02 APT |
| OKX | ✅ | APT/USDT | 0.02 APT |
| Bybit | ✅ | APT/USDT | 0.01 APT |
| KuCoin | ✅ | APT/USDT | 0.02 APT |
| **Coinbase** | ✅ | APT/USD | 동적 |

- **체인 파이널리티**: Zaptos — sub-50ms 블록 타임
- **실전 전송 시간**: ~1분 (거래소 처리 포함)
- **현재 가격**: ~$1.75

---

## 4. 수정 대상 파일 목록

### 4.1 코어 코드 (API)

| 파일 | 변경 내용 |
|------|-----------|
| `apps/api/src/constants.ts` | TRACKED_PAIRS에 SUI/APT 추가, BRIDGE_COINS 11→13, EXCHANGE_FEES에 coinbase:0.50, WITHDRAWAL_FEES 전 거래소에 SUI/APT 추가 + coinbase 신규, TRANSFER_TIME_MIN에 SUI:1/APT:1, ROUTING_EXCHANGES에 'coinbase', ROUTING_EXCHANGE_CURRENCIES/DISPLAY_NAME/COUNTRY에 coinbase 추가, GLOBAL_ROUTING_EXCHANGE_SET에 coinbase 추가 |
| `apps/api/src/lib/fetchers.ts` | `fetchCoinbasePrices()` 신규 생성, `fetchGlobalPrices()`에 Coinbase 통합 (Promise.allSettled + merge), COINGECKO_IDS에 SUI/APT 추가, CROSSFIN_UA 버전 업데이트 |
| `apps/api/src/routes/routing.ts` | `getRouteStatusPayload()` 헬스체크에 Coinbase API 핑 추가, statusByExchange에 coinbase 추가 |
| `apps/api/src/index.ts` | fetchCoinbasePrices import 추가, 문자열 리터럴 업데이트 (13→14 exchanges, 11→13 bridge coins, 거래소 목록에 Coinbase 추가) |

### 4.2 문서/메타데이터

| 파일 | 변경 내용 |
|------|-----------|
| `README.md` | 13→14 exchanges, 11→13 bridge coins, 거래소/코인 목록 업데이트 |
| `AGENTS.md` | 동일 |
| `CHANGELOG.md` | v1.15.0 항목 추가 |
| `catalog/crossfin-catalog.json` | apiVersion 업데이트, 서비스 설명 갱신 |
| `apps/api/src/routes/discovery.ts` | crossfin.json, agent.json, ai-plugin.json, llms.txt 내 거래소/코인 수 갱신 |
| `apps/api/src/routes/mcp.ts` | 툴 description 갱신 |
| `apps/mcp-server/src/index.ts` | 거래소/코인 수 갱신 |
| `apps/mcp-server/README.md` | 동일 |
| `apps/mcp-server/package.json` | version 업데이트 |
| `apps/mcp-server/server.json` | version 업데이트 |
| `apps/docs/api.md` | 14 exchanges, 13 bridge coins |
| `apps/docs/mcp.md` | 동일 |
| `apps/docs/quickstart.md` | 거래소 목록 갱신 |
| `apps/docs/telegram.md` | 동일 |
| `apps/docs/index.md` | 동일 |
| `apps/web/index.html` | 거래소 수, 코인 수 갱신 |
| `examples/agent-system-prompt.md` | 14 exchanges, 13 bridge coins |
| `examples/sample-prompts.md` | 거래소 목록 갱신 |
| `examples/gpt-actions-schema.yaml` | version 업데이트 |
| `smithery.yaml` | version 업데이트 |
| `packages/sdk/package.json` | version 업데이트 |

### 4.3 버전 파일 (AGENTS.md 체크리스트)

v1.14.0 → v1.15.0 동시 업데이트 대상:

```
[ ] catalog/crossfin-catalog.json          → apiVersion
[ ] apps/mcp-server/package.json           → version
[ ] apps/mcp-server/server.json            → version + packages[].version
[ ] apps/mcp-server/package-lock.json      → npm install로 자동
[ ] packages/sdk/package.json              → version
[ ] packages/sdk/package-lock.json         → npm install로 자동
[ ] packages/sdk/src/types.ts              → 버전 문자열 변경
[ ] packages/sdk/README.md                 → 예시 출력의 version
[ ] apps/web/public/.well-known/crossfin.json → version + updatedAt
[ ] examples/gpt-actions-schema.yaml       → version
[ ] smithery.yaml                          → crossfin-mcp@{version}
[ ] CHANGELOG.md                           → 새 버전 항목 추가
```

---

## 5. 구현 순서

### Phase 1: 코어 코드 (API 기능)
1. `constants.ts` — SUI/APT 추가 (TRACKED_PAIRS, BRIDGE_COINS, WITHDRAWAL_FEES, TRANSFER_TIME_MIN)
2. `constants.ts` — Coinbase 추가 (ROUTING_EXCHANGES, EXCHANGE_FEES, WITHDRAWAL_FEES, DISPLAY_NAME, COUNTRY, CURRENCIES, GLOBAL_SET)
3. `fetchers.ts` — `fetchCoinbasePrices()` 생성 (Advanced Trade API 패턴)
4. `fetchers.ts` — `fetchGlobalPrices()`에 Coinbase 통합
5. `fetchers.ts` — COINGECKO_IDS에 SUI/APT 추가
6. `routes/routing.ts` — Coinbase 헬스체크 추가
7. `index.ts` — import + 문자열 리터럴 갱신

### Phase 2: 로컬 테스트
8. `npm run dev` → 빌드 확인
9. `/api/route/exchanges` → Coinbase + SUI/APT 노출 확인
10. `/api/route/pairs?coin=SUI` → SUI 가격 정상 확인
11. `/api/route/pairs?coin=APT` → APT 가격 정상 확인
12. `/api/premium/route/find?from=coinbase:USDC&to=bithumb:KRW&amount=1000` → 라우팅 정상
13. `/api/route/status` → Coinbase online 확인

### Phase 3: 문서/메타데이터 갱신
14. 19+ 파일의 "13 exchanges" → "14 exchanges", "11 bridge coins" → "13 bridge coins" 일괄 갱신
15. 거래소 목록 리터럴에 ", Coinbase" 추가
16. 코인 목록 리터럴에 ", SUI, APT" 추가

### Phase 4: 버전업 + 배포
17. v1.14.0 → v1.15.0 (12개 파일 동시)
18. CHANGELOG.md에 v1.15.0 항목 작성
19. 커밋 → 로컬 최종 확인
20. npm publish (MCP + SDK)
21. wrangler deploy (API)
22. wrangler pages deploy (Web, Docs, Live — 변경 시)

---

## 6. 최종 스펙 요약

| 항목 | Before (v1.14.0) | After (v1.15.0) |
|------|-------------------|------------------|
| 거래소 수 | 13 | **14** (+Coinbase) |
| 브릿지 코인 | 11 (BTC, ETH, XRP, SOL, DOGE, ADA, DOT, LINK, AVAX, TRX, KAIA) | **13** (+SUI, +APT) |
| 라우팅 경로 | 13×11 = ~143 | **14×13 = ~182** |
| Global 거래소 | Binance, OKX, Bybit, KuCoin | +**Coinbase** |
| 신규 fetcher | — | `fetchCoinbasePrices()` |
| Coinbase 특이사항 | — | TRX/KAIA 미지원 (나머지 13개 코인 중 11개 지원) |

---

## 7. 리스크

| 리스크 | 영향 | 대응 |
|--------|------|------|
| Coinbase API 응답 형태 변경 | fetcher 에러 | 기존 4개 글로벌 거래소 fallback으로 커버됨 |
| Coinbase에 TRX/KAIA 없음 | 해당 코인의 Coinbase 라우팅 불가 | WITHDRAWAL_FEES에서 해당 코인 생략 → 라우팅 엔진이 자동 제외 |
| SUI/APT 출금 수수료 부정확 | 라우팅 비용 오차 | 보수적 추정치 사용, D1 DB 업데이트로 운영 중 조정 가능 |
| Coinone SUI 출금 수수료 높음 (1.0 SUI) | Coinone→타거래소 SUI 라우팅 비용 증가 | 라우팅 엔진이 자동으로 저비용 코인 선호 |

---

## 8. 미래 작업 (이번 범위 밖)

- **TON 브릿지 코인 추가** — 규제 리스크 검증 후 별도 진행
- **Jupiter DEX 가격 참조** — 라우팅 거래소가 아닌 보조 가격 소스로 검토
- **HashKey/OSL** — Public API 제공 시 재검토
