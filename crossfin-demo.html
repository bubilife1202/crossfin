<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CrossFin â€” Demo Video</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700;900&family=JetBrains+Mono:wght@400;700&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #0B0F1E; overflow: hidden; width: 1920px; height: 1080px; font-family: 'Noto Sans KR', sans-serif; }

  #canvas { position: absolute; top: 0; left: 0; width: 1920px; height: 1080px; z-index: 0; }

  .scene { position: absolute; top: 0; left: 0; width: 1920px; height: 1080px; opacity: 0; z-index: 1; display: flex; align-items: center; justify-content: center; pointer-events: none; }
  .scene.active { opacity: 1; }

  /* â”€â”€ Colors â”€â”€ */
  :root {
    --bg: #0B0F1E; --card: #111827; --card-alt: #1A2236;
    --accent: #00C2FF; --green: #00E68A; --gold: #FFB800; --red: #FF4D4D;
    --white: #F1F5F9; --light: #CBD5E1; --muted: #94A3B8; --dim: #475569;
  }

  /* â”€â”€ Shared animations â”€â”€ */
  @keyframes fadeInUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
  @keyframes scaleIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
  @keyframes slideRight { from { opacity: 0; transform: translateX(-60px); } to { opacity: 1; transform: translateX(0); } }
  @keyframes slideLeft { from { opacity: 0; transform: translateX(60px); } to { opacity: 1; transform: translateX(0); } }
  @keyframes pulseGlow { 0%, 100% { filter: drop-shadow(0 0 8px var(--accent)); } 50% { filter: drop-shadow(0 0 24px var(--accent)); } }
  @keyframes countUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes typing { from { width: 0; } to { width: 100%; } }
  @keyframes blink { 0%, 100% { border-right-color: var(--accent); } 50% { border-right-color: transparent; } }
  @keyframes shakeX { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); } 20%, 40%, 60%, 80% { transform: translateX(4px); } }
  @keyframes glowPulse { 0%, 100% { box-shadow: 0 0 20px rgba(0,194,255,0.3); } 50% { box-shadow: 0 0 40px rgba(0,194,255,0.6); } }
  @keyframes flowDash { to { stroke-dashoffset: -20; } }
  @keyframes highlight { from { background-size: 0% 100%; } to { background-size: 100% 100%; } }
  @keyframes rotateIn { from { opacity:0; transform: rotate(-10deg) scale(0.9); } to { opacity:1; transform: rotate(0) scale(1); } }

  /* â”€â”€ Scene 1: Hook â”€â”€ */
  #scene1 .hook-text {
    font-size: 64px; font-weight: 900; color: var(--white); text-align: center;
    line-height: 1.4; letter-spacing: -1px;
  }
  #scene1 .hook-sub {
    font-size: 28px; color: var(--muted); text-align: center; margin-top: 20px;
  }
  #scene1 .amount {
    display: inline-block; color: var(--accent);
    background: linear-gradient(90deg, rgba(0,194,255,0.15), transparent);
    padding: 4px 16px; border-radius: 8px;
  }
  #scene1 .exchange-from { color: var(--gold); }
  #scene1 .exchange-to { color: var(--green); }

  /* â”€â”€ Scene 2: Problem â”€â”€ */
  #scene2 { flex-direction: column; gap: 30px; }
  #scene2 .problem-title {
    font-size: 42px; font-weight: 900; color: var(--white); text-align: center;
  }
  .exchange-grid {
    display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; max-width: 1600px;
  }
  .ex-card {
    background: var(--card); border: 1px solid #1E293B; border-radius: 12px;
    padding: 20px 28px; min-width: 200px; opacity: 0;
  }
  .ex-card .name { font-size: 18px; font-weight: 700; color: var(--white); margin-bottom: 6px; }
  .ex-card .coin { font-size: 14px; color: var(--muted); }
  .ex-card .fee { font-size: 24px; font-weight: 900; margin-top: 8px; }
  .ex-card .fee.bad { color: var(--red); }
  .ex-card .fee.mid { color: var(--gold); }
  .ex-card .fee.ok { color: var(--muted); }
  .ex-card .network { font-size: 12px; color: var(--dim); margin-top: 4px; }
  .ex-card.wrong { border: 2px solid var(--red); animation: shakeX 0.5s ease; }
  .ex-card.wrong::after {
    content: 'âœ• ì˜ëª»ëœ ì„ íƒ'; display: block; font-size: 13px; color: var(--red);
    font-weight: 700; margin-top: 8px;
  }

  .loss-banner {
    background: rgba(255,77,77,0.12); border: 1px solid var(--red); border-radius: 12px;
    padding: 24px 48px; text-align: center; opacity: 0;
  }
  .loss-banner .loss-amount { font-size: 56px; font-weight: 900; color: var(--red); }
  .loss-banner .loss-desc { font-size: 20px; color: var(--muted); margin-top: 8px; }

  /* â”€â”€ Scene 3: Solution â”€â”€ */
  #scene3 { flex-direction: column; align-items: center; gap: 0; }
  .prompt-box {
    background: var(--card); border: 1px solid #1E293B; border-radius: 16px;
    padding: 28px 40px; width: 900px; opacity: 0;
  }
  .prompt-label { font-size: 14px; color: var(--dim); margin-bottom: 12px; font-family: 'JetBrains Mono', monospace; }
  .prompt-text {
    font-size: 26px; color: var(--accent); font-weight: 700;
    border-right: 3px solid var(--accent); white-space: nowrap; overflow: hidden; width: 0;
    font-family: 'JetBrains Mono', monospace;
  }
  .prompt-text.typing { animation: typing 2s steps(30) forwards, blink 0.7s step-end infinite; }

  .route-result {
    width: 1100px; margin-top: 40px; opacity: 0;
  }
  .route-header {
    font-size: 16px; color: var(--dim); margin-bottom: 20px;
    font-family: 'JetBrains Mono', monospace;
  }
  .route-header .count { color: var(--accent); font-weight: 700; }
  .route-row {
    display: flex; align-items: center; gap: 16px; padding: 16px 24px;
    background: var(--card); border: 1px solid #1E293B; border-radius: 10px;
    margin-bottom: 10px; opacity: 0; transform: translateX(-30px);
  }
  .route-row.best {
    border: 2px solid var(--green); background: rgba(0,230,138,0.06);
    box-shadow: 0 0 30px rgba(0,230,138,0.15);
  }
  .route-row .rank { font-size: 14px; color: var(--dim); font-weight: 700; width: 30px; font-family: 'JetBrains Mono', monospace; }
  .route-row.best .rank { color: var(--green); }
  .route-row .coin-name { font-size: 22px; font-weight: 900; color: var(--white); width: 80px; }
  .route-row.best .coin-name { color: var(--green); }
  .route-row .chain { font-size: 14px; color: var(--muted); width: 120px; }
  .route-row .fee-val { font-size: 28px; font-weight: 900; width: 140px; text-align: right; }
  .route-row.best .fee-val { color: var(--green); }
  .route-row .fee-val.dim { color: var(--dim); }
  .route-row .time-val { font-size: 16px; color: var(--muted); width: 100px; text-align: right; }
  .route-row .tag { font-size: 12px; font-weight: 700; padding: 4px 12px; border-radius: 4px; margin-left: auto; }
  .route-row.best .tag { background: var(--green); color: var(--bg); }
  .route-row .saving { font-size: 14px; color: var(--green); font-weight: 700; margin-left: 16px; }

  .route-flow {
    display: flex; align-items: center; justify-content: center; gap: 20px;
    margin-top: 30px; opacity: 0;
  }
  .flow-node {
    padding: 14px 28px; border-radius: 10px; font-size: 18px; font-weight: 700;
  }
  .flow-node.from { background: var(--accent); color: var(--bg); }
  .flow-node.to { background: var(--green); color: var(--bg); }
  .flow-arrow {
    font-size: 32px; color: var(--green); font-weight: 900;
    display: flex; align-items: center; gap: 8px;
  }
  .flow-arrow .coin-badge {
    font-size: 16px; background: rgba(0,230,138,0.15); padding: 4px 12px;
    border-radius: 6px; color: var(--green);
  }

  /* â”€â”€ Scene 3b: Algorithm â”€â”€ */
  #scene3b { flex-direction: column; align-items: center; gap: 30px; }
  .algo-title { font-size: 42px; font-weight: 900; color: var(--white); text-align: center; opacity: 0; }
  .algo-subtitle { font-size: 22px; color: var(--muted); text-align: center; opacity: 0; }
  .algo-grid { display: flex; gap: 24px; opacity: 0; }
  .algo-card {
    background: var(--card); border: 1px solid #1E293B; border-radius: 14px;
    padding: 28px 32px; width: 320px; text-align: center;
  }
  .algo-card .algo-icon { font-size: 40px; margin-bottom: 12px; }
  .algo-card .algo-name { font-size: 20px; font-weight: 700; color: var(--white); margin-bottom: 8px; }
  .algo-card .algo-desc { font-size: 14px; color: var(--muted); line-height: 1.6; }
  .algo-card:nth-child(1) { border-top: 3px solid var(--green); }
  .algo-card:nth-child(2) { border-top: 3px solid var(--accent); }
  .algo-card:nth-child(3) { border-top: 3px solid var(--gold); }
  .algo-card:nth-child(1) .algo-name { color: var(--green); }
  .algo-card:nth-child(2) .algo-name { color: var(--accent); }
  .algo-card:nth-child(3) .algo-name { color: var(--gold); }

  /* â”€â”€ Scene 4: Future â”€â”€ */
  #scene4 { flex-direction: column; align-items: center; gap: 30px; }
  .future-title { font-size: 48px; font-weight: 900; color: var(--white); text-align: center; opacity: 0; }
  .future-sub { font-size: 24px; color: var(--muted); text-align: center; opacity: 0; }
  .agent-grid { display: flex; gap: 24px; margin-top: 10px; opacity: 0; }
  .agent-card {
    background: var(--card); border: 1px solid #1E293B; border-radius: 14px;
    padding: 32px; width: 380px; position: relative; overflow: hidden;
  }
  .agent-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
  }
  .agent-card:nth-child(1)::before { background: var(--accent); }
  .agent-card:nth-child(2)::before { background: var(--green); }
  .agent-card:nth-child(3)::before { background: var(--gold); }
  .agent-card .a-badge {
    font-size: 11px; font-weight: 700; letter-spacing: 2px; margin-bottom: 12px;
    padding: 4px 10px; border-radius: 4px; display: inline-block;
  }
  .agent-card:nth-child(1) .a-badge { color: var(--accent); background: rgba(0,194,255,0.1); }
  .agent-card:nth-child(2) .a-badge { color: var(--green); background: rgba(0,230,138,0.1); }
  .agent-card:nth-child(3) .a-badge { color: var(--gold); background: rgba(255,184,0,0.1); }
  .agent-card .a-title { font-size: 22px; font-weight: 700; color: var(--white); margin-bottom: 10px; }
  .agent-card .a-desc { font-size: 15px; color: var(--muted); line-height: 1.6; }
  .agent-card .a-proto {
    margin-top: 16px; font-size: 13px; font-weight: 700; font-family: 'JetBrains Mono', monospace;
    padding: 6px 12px; background: rgba(0,194,255,0.08); border-radius: 6px; display: inline-block;
  }
  .agent-card:nth-child(1) .a-proto { color: var(--accent); }
  .agent-card:nth-child(2) .a-proto { color: var(--green); }
  .agent-card:nth-child(3) .a-proto { color: var(--gold); }

  .bot-flow {
    display: flex; align-items: center; gap: 16px; margin-top: 10px; opacity: 0;
  }
  .bot-node {
    padding: 12px 24px; border-radius: 8px; font-size: 15px; font-weight: 700;
    background: var(--card); border: 1px solid #1E293B; color: var(--light);
  }
  .bot-arrow { font-size: 20px; color: var(--accent); animation: pulseGlow 2s infinite; }

  /* â”€â”€ Scene 5: Closing â”€â”€ */
  #scene5 { flex-direction: column; align-items: center; gap: 20px; }
  .closing-logo {
    font-size: 96px; font-weight: 900; color: var(--white); letter-spacing: 12px;
    opacity: 0; text-shadow: 0 0 60px rgba(0,194,255,0.3);
  }
  .closing-tagline { font-size: 28px; color: var(--accent); opacity: 0; }
  .closing-url { font-size: 22px; color: var(--muted); opacity: 0; font-family: 'JetBrains Mono', monospace; }
  .closing-stats {
    display: flex; gap: 48px; margin-top: 20px; opacity: 0;
  }
  .closing-stat .num { font-size: 36px; font-weight: 900; color: var(--accent); }
  .closing-stat .lbl { font-size: 14px; color: var(--dim); margin-top: 4px; }

  /* â”€â”€ Progress bar â”€â”€ */
  #progress {
    position: absolute; bottom: 0; left: 0; height: 3px; background: var(--accent);
    z-index: 100; width: 0%; transition: width 0.1s linear;
  }

  /* â”€â”€ Timer debug â”€â”€ */
  #timer {
    position: absolute; top: 20px; right: 30px; z-index: 100;
    font-family: 'JetBrains Mono', monospace; font-size: 14px; color: var(--dim);
  }
</style>
</head>
<body>
<canvas id="canvas" width="1920" height="1080"></canvas>

<!-- â•â•â• SCENE 1: Hook â•â•â• -->
<div id="scene1" class="scene">
  <div style="text-align:center;">
    <div class="hook-text" style="opacity:0;">
      <span class="exchange-from">ë¹—ì¸</span>ì—ì„œ
      <span class="exchange-to">ë°”ì´ë‚¸ìŠ¤</span>ë¡œ<br/>
      <span class="amount">100ë§Œì›</span> ë³´ë‚´ë ¤ë©´
    </div>
    <div class="hook-sub" style="opacity:0;">ì–´ë–¤ ì½”ì¸ìœ¼ë¡œ, ì–´ë–¤ ì²´ì¸ìœ¼ë¡œ ë³´ë‚´ì•¼ ê°€ì¥ ì‹¸ì§€?</div>
  </div>
</div>

<!-- â•â•â• SCENE 2: Problem â•â•â• -->
<div id="scene2" class="scene">
  <div class="problem-title" style="opacity:0;">ì‚¬ëŒì´ ì§ì ‘ ë¹„êµí•œë‹¤ë©´?</div>
  <div class="exchange-grid" id="exGrid"></div>
  <div class="loss-banner" id="lossBanner">
    <div class="loss-amount">âˆ’â‚©23,400</div>
    <div class="loss-desc">ë§¤ë²ˆ, ìµœì ì´ ì•„ë‹Œ ê²½ë¡œë¡œ ë³´ë‚´ë©´ ì´ë§Œí¼ ìƒëŠ”ë‹¤</div>
  </div>
</div>

<!-- â•â•â• SCENE 3: Solution â•â•â• -->
<div id="scene3" class="scene">
  <div class="prompt-box" id="promptBox">
    <div class="prompt-label">crossfin.dev</div>
    <div class="prompt-text" id="promptText">ë¹—ì¸ â†’ ë°”ì´ë‚¸ìŠ¤, 100ë§Œì›, ìµœì  ê²½ë¡œ?</div>
  </div>
  <div class="route-result" id="routeResult">
    <div class="route-header">
      <span class="count">93</span>ê°œ ê²½ë¡œ ë¶„ì„ ì™„ë£Œ Â· <span style="color:var(--green);">ìµœì  ê²½ë¡œ ë°œê²¬</span>
    </div>
    <div id="routeRows"></div>
    <div class="route-flow" id="routeFlow">
      <div class="flow-node from">ë¹—ì¸ Â· KRW 100ë§Œì›</div>
      <div class="flow-arrow">
        â”€â”€
        <span class="coin-badge">XRP Â· Ripple</span>
        â”€â”€â–¸
      </div>
      <div class="flow-node to">ë°”ì´ë‚¸ìŠ¤ Â· USDC $716</div>
    </div>
  </div>
</div>

<!-- â•â•â• SCENE 3b: Algorithm â•â•â• -->
<div id="scene3b" class="scene">
  <div class="algo-title">ìµœì  ê²½ë¡œ ì•Œê³ ë¦¬ì¦˜</div>
  <div class="algo-subtitle">ë¹„ìš© Â· ì†ë„ Â· ë¦¬ìŠ¤í¬ â€” 3ê°€ì§€ ê¸°ì¤€ìœ¼ë¡œ 90+ ê²½ë¡œë¥¼ ì „ìˆ˜ ë¶„ì„</div>
  <div class="algo-grid">
    <div class="algo-card">
      <div class="algo-icon">ğŸ’°</div>
      <div class="algo-name">CHEAPEST</div>
      <div class="algo-desc">ê±°ë˜ìˆ˜ìˆ˜ë£Œ + ì¶œê¸ˆìˆ˜ìˆ˜ë£Œ +<br/>ë„¤íŠ¸ì›Œí¬ë¹„ + í˜¸ê°€ì°¨ì´ + í™˜ìœ¨<br/>ëª¨ë“  ë¹„ìš©ì„ í•©ì‚°í•´ì„œ ìµœì €ê°€ ê²½ë¡œ</div>
    </div>
    <div class="algo-card">
      <div class="algo-icon">âš¡</div>
      <div class="algo-name">FASTEST</div>
      <div class="algo-desc">ì²´ì¸ë³„ ì»¨íŒ ì‹œê°„ +<br/>ê±°ë˜ì†Œ ì²˜ë¦¬ ì‹œê°„ í•©ì‚°<br/>ê°€ì¥ ë¹ ë¥¸ ë„ì°© ê²½ë¡œ</div>
    </div>
    <div class="algo-card">
      <div class="algo-icon">âš–ï¸</div>
      <div class="algo-name">BALANCED</div>
      <div class="algo-desc">ë¹„ìš© Ã— 0.5 + ì†ë„ Ã— 0.3 +<br/>ë¦¬ìŠ¤í¬ Ã— 0.2 ê°€ì¤‘ì¹˜ ì ìš©<br/>ê°€ì„±ë¹„ ìµœì  ê²½ë¡œ</div>
    </div>
  </div>
</div>

<!-- â•â•â• SCENE 4: Future â•â•â• -->
<div id="scene4" class="scene">
  <div class="future-title">ê±°ë˜ì†Œê°€ ëŠ˜ì–´ë‚˜ê³ , ì²´ì¸ì´ ëŠ˜ì–´ë‚˜ë„</div>
  <div class="future-sub">ì—ì´ì „íŠ¸ê°€ ì•Œì•„ì„œ ìµœì  ê²½ë¡œë¥¼ ì°¾ëŠ”ë‹¤</div>
  <div class="agent-grid">
    <div class="agent-card">
      <div class="a-badge">NOW</div>
      <div class="a-title">ì‚¬ëŒì„ ìœ„í•œ ë¼ìš°í„°</div>
      <div class="a-desc">íŠ¸ë ˆì´ë”ê°€ ì§ì ‘ ë¬¼ì–´ë³´ë©´<br/>ìµœì  ê²½ë¡œë¥¼ ì¦‰ì‹œ ì œì‹œ</div>
      <div class="a-proto">Telegram Â· API Â· Web</div>
    </div>
    <div class="agent-card">
      <div class="a-badge">NEXT</div>
      <div class="a-title">ì—ì´ì „íŠ¸ë¥¼ ìœ„í•œ API</div>
      <div class="a-desc">AI ì—ì´ì „íŠ¸ê°€ ì§ì ‘ í˜¸ì¶œ<br/>ì¿¼ë¦¬ë‹¹ $0.05~$0.10 ê³¼ê¸ˆ</div>
      <div class="a-proto">MCP Â· x402 Protocol</div>
    </div>
    <div class="agent-card">
      <div class="a-badge">SCALE</div>
      <div class="a-title">ììœ¨ ë¼ìš°íŒ… ì¸í”„ë¼</div>
      <div class="a-desc">ë´‡ë“¤ì´ ìë™ìœ¼ë¡œ ìµœì  ê²½ë¡œ ì‹¤í–‰<br/>í¬ë¡œìŠ¤ë³´ë” ê²°ì œì˜ í‘œì¤€ ë ˆì´ì–´</div>
      <div class="a-proto">Agent-to-Agent</div>
    </div>
  </div>
  <div class="bot-flow" id="botFlow">
    <div class="bot-node">ğŸ¤– AI Agent</div>
    <div class="bot-arrow">â†’</div>
    <div class="bot-node" style="border-color:var(--accent);color:var(--accent);">CrossFin API</div>
    <div class="bot-arrow">â†’</div>
    <div class="bot-node">ìµœì  ê²½ë¡œ</div>
    <div class="bot-arrow">â†’</div>
    <div class="bot-node">ìë™ ì‹¤í–‰</div>
    <div class="bot-arrow">â†’</div>
    <div class="bot-node" style="border-color:var(--green);color:var(--green);">ì™„ë£Œ âœ“</div>
  </div>
</div>

<!-- â•â•â• SCENE 5: Closing â•â•â• -->
<div id="scene5" class="scene">
  <div class="closing-logo">CROSSFIN</div>
  <div class="closing-tagline">ì—ì´ì „íŠ¸ê°€ ëˆì„ ì›€ì§ì´ëŠ” ì‹œëŒ€. ê·¸ ê¸¸ì„ ë§Œë“ ë‹¤.</div>
  <div class="closing-stats">
    <div class="closing-stat"><div class="num">9</div><div class="lbl">ê±°ë˜ì†Œ</div></div>
    <div class="closing-stat"><div class="num">90+</div><div class="lbl">ì‹¤ì‹œê°„ ê²½ë¡œ</div></div>
    <div class="closing-stat"><div class="num">80</div><div class="lbl">API ì—”ë“œí¬ì¸íŠ¸</div></div>
    <div class="closing-stat"><div class="num">7</div><div class="lbl">ë°°í¬ ì±„ë„</div></div>
  </div>
  <div class="closing-url">crossfin.dev</div>
</div>

<div id="progress"></div>
<div id="timer"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Timeline Engine
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TOTAL_DURATION = 60000; // 60 seconds
let startTime = null;
let currentScene = null;

function getTime() { return startTime ? Date.now() - startTime : 0; }

function showScene(id) {
  if (currentScene === id) return;
  document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
  const el = document.getElementById(id);
  if (el) { el.classList.add('active'); currentScene = id; }
}

function animateEl(el, delay, anim, duration = 600) {
  if (!el) return;
  setTimeout(() => {
    el.style.animation = `${anim} ${duration}ms ease forwards`;
    el.style.opacity = '1';
  }, delay);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Canvas â€” Background particles + network lines
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

class Particle {
  constructor() { this.reset(); }
  reset() {
    this.x = Math.random() * 1920;
    this.y = Math.random() * 1080;
    this.vx = (Math.random() - 0.5) * 0.5;
    this.vy = (Math.random() - 0.5) * 0.5;
    this.r = Math.random() * 1.5 + 0.5;
    this.alpha = Math.random() * 0.3 + 0.1;
  }
  update() {
    this.x += this.vx; this.y += this.vy;
    if (this.x < 0 || this.x > 1920) this.vx *= -1;
    if (this.y < 0 || this.y > 1080) this.vy *= -1;
  }
  draw() {
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(0, 194, 255, ${this.alpha})`;
    ctx.fill();
  }
}

const particles = Array.from({ length: 80 }, () => new Particle());

// Network nodes for problem scene
const exchangeNodes = [
  { name: 'Bithumb', x: 300, y: 200 }, { name: 'Upbit', x: 200, y: 400 },
  { name: 'Coinone', x: 400, y: 500 }, { name: 'GoPax', x: 150, y: 650 },
  { name: 'Binance', x: 1600, y: 250 }, { name: 'OKX', x: 1700, y: 450 },
  { name: 'Bybit', x: 1500, y: 600 }, { name: 'bitFlyer', x: 1650, y: 700 },
  { name: 'WazirX', x: 1400, y: 800 },
];

let showNetwork = false;
let networkAlpha = 0;
let showRouteAnim = false;
let routeAnimProgress = 0;

function drawNetwork() {
  if (!showNetwork) return;
  networkAlpha = Math.min(networkAlpha + 0.02, 0.6);

  // Draw connecting lines (chaotic)
  exchangeNodes.forEach((a, i) => {
    exchangeNodes.forEach((b, j) => {
      if (i >= j) return;
      ctx.beginPath();
      ctx.moveTo(a.x, a.y);
      ctx.lineTo(b.x, b.y);
      ctx.strokeStyle = `rgba(255, 77, 77, ${networkAlpha * 0.15})`;
      ctx.lineWidth = 0.5;
      ctx.stroke();
    });
  });

  // Draw nodes
  exchangeNodes.forEach(n => {
    ctx.beginPath();
    ctx.arc(n.x, n.y, 8, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(0, 194, 255, ${networkAlpha})`;
    ctx.fill();
    ctx.beginPath();
    ctx.arc(n.x, n.y, 14, 0, Math.PI * 2);
    ctx.strokeStyle = `rgba(0, 194, 255, ${networkAlpha * 0.3})`;
    ctx.lineWidth = 1;
    ctx.stroke();
    // name
    ctx.fillStyle = `rgba(148, 163, 184, ${networkAlpha})`;
    ctx.font = '12px "Noto Sans KR"';
    ctx.textAlign = 'center';
    ctx.fillText(n.name, n.x, n.y + 26);
  });
}

function drawRouteAnimation() {
  if (!showRouteAnim) return;
  routeAnimProgress = Math.min(routeAnimProgress + 0.008, 1);
  const fromX = 300, fromY = 200;
  const toX = 1600, toY = 250;
  const midX = 960, midY = 100;

  // Optimal route (green, glowing)
  const prog = routeAnimProgress;
  const cx = fromX + (midX - fromX) * prog;
  const cy = fromY + (midY - fromY) * prog * 2 * (1 - prog) + (toY - fromY) * prog * prog;
  const endX = fromX + (toX - fromX) * prog;
  const endY = fromY + (toY - fromY) * prog;

  ctx.beginPath();
  ctx.moveTo(fromX, fromY);
  ctx.quadraticCurveTo(midX, midY - 80, endX, endY);
  ctx.strokeStyle = `rgba(0, 230, 138, 0.8)`;
  ctx.lineWidth = 3;
  ctx.stroke();

  // Particle along route
  if (prog < 1) {
    ctx.beginPath();
    ctx.arc(endX, endY, 6, 0, Math.PI * 2);
    ctx.fillStyle = '#00E68A';
    ctx.fill();
    ctx.beginPath();
    ctx.arc(endX, endY, 12, 0, Math.PI * 2);
    ctx.fillStyle = 'rgba(0, 230, 138, 0.3)';
    ctx.fill();
  }
}

function renderCanvas() {
  ctx.clearRect(0, 0, 1920, 1080);

  // Background gradient
  const grad = ctx.createRadialGradient(960, 540, 200, 960, 540, 1000);
  grad.addColorStop(0, '#0F1428');
  grad.addColorStop(1, '#0B0F1E');
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, 1920, 1080);

  particles.forEach(p => { p.update(); p.draw(); });
  drawNetwork();
  drawRouteAnimation();

  requestAnimationFrame(renderCanvas);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Scene builders
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Build exchange comparison cards
function buildExCards() {
  const grid = document.getElementById('exGrid');
  const cards = [
    { name: 'BTC', fee: '1.65%', time: '22ë¶„', cls: 'bad', net: 'Bitcoin Network' },
    { name: 'ETH', fee: '1.42%', time: '7ë¶„', cls: 'mid', net: 'Ethereum L1' },
    { name: 'SOL', fee: '0.95%', time: '1ë¶„', cls: 'mid', net: 'Solana' },
    { name: 'XRP', fee: '0.87%', time: '2.5ë¶„', cls: 'ok', net: 'Ripple' },
    { name: 'DOGE', fee: '1.89%', time: '10ë¶„', cls: 'bad', net: 'Dogecoin' },
    { name: 'TRX', fee: '0.92%', time: '1ë¶„', cls: 'mid', net: 'Tron' },
  ];
  cards.forEach(c => {
    const div = document.createElement('div');
    div.className = 'ex-card';
    div.innerHTML = `<div class="name">${c.name}</div><div class="coin">ë¹—ì¸ â†’ ë°”ì´ë‚¸ìŠ¤</div><div class="fee ${c.cls}">${c.fee}</div><div class="network">${c.net} Â· ${c.time}</div>`;
    grid.appendChild(div);
  });
}

function buildRouteRows() {
  const container = document.getElementById('routeRows');
  const routes = [
    { rank: '#1', coin: 'XRP', chain: 'Ripple', fee: '0.87%', time: '2.5ë¶„', best: true, tag: 'CHEAPEST', saving: 'â‚©7,800 ì ˆì•½' },
    { rank: '#2', coin: 'TRX', chain: 'Tron', fee: '0.92%', time: '1ë¶„', best: false },
    { rank: '#3', coin: 'SOL', chain: 'Solana', fee: '0.95%', time: '1ë¶„', best: false },
    { rank: '#4', coin: 'ETH', chain: 'Ethereum', fee: '1.42%', time: '7ë¶„', best: false },
    { rank: '#5', coin: 'BTC', chain: 'Bitcoin', fee: '1.65%', time: '22ë¶„', best: false },
  ];
  routes.forEach(r => {
    const div = document.createElement('div');
    div.className = `route-row${r.best ? ' best' : ''}`;
    div.innerHTML = `
      <div class="rank">${r.rank}</div>
      <div class="coin-name">${r.coin}</div>
      <div class="chain">${r.chain}</div>
      <div class="fee-val ${r.best ? '' : 'dim'}">${r.fee}</div>
      <div class="time-val">${r.time}</div>
      ${r.tag ? `<div class="tag">${r.tag}</div>` : ''}
      ${r.saving ? `<div class="saving">${r.saving}</div>` : ''}
    `;
    container.appendChild(div);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Main Timeline
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function runTimeline() {
  startTime = Date.now();
  buildExCards();
  buildRouteRows();

  // === SCENE 1: Hook (0-7s) ===
  showScene('scene1');
  const hookText = document.querySelector('#scene1 .hook-text');
  const hookSub = document.querySelector('#scene1 .hook-sub');
  animateEl(hookText, 500, 'fadeInUp', 800);
  animateEl(hookSub, 2000, 'fadeInUp', 600);

  // === SCENE 2: Problem (7-18s) ===
  setTimeout(() => {
    showScene('scene2');
    showNetwork = true;
    const title = document.querySelector('#scene2 .problem-title');
    animateEl(title, 300, 'fadeInUp', 600);

    const cards = document.querySelectorAll('.ex-card');
    cards.forEach((c, i) => {
      animateEl(c, 800 + i * 300, 'scaleIn', 400);
    });

    // Mark wrong choice
    setTimeout(() => {
      cards[0].classList.add('wrong'); // BTC
      cards[4].classList.add('wrong'); // DOGE
    }, 4000);

    // Show loss
    setTimeout(() => {
      const banner = document.getElementById('lossBanner');
      animateEl(banner, 0, 'scaleIn', 500);
    }, 5500);
  }, 7000);

  // === SCENE 3: Solution (18-35s) ===
  setTimeout(() => {
    showScene('scene3');
    showNetwork = false;
    networkAlpha = 0;

    const promptBox = document.getElementById('promptBox');
    animateEl(promptBox, 300, 'fadeInUp', 600);

    setTimeout(() => {
      document.getElementById('promptText').classList.add('typing');
    }, 1200);

    // Show results
    setTimeout(() => {
      const result = document.getElementById('routeResult');
      animateEl(result, 0, 'fadeIn', 400);

      showRouteAnim = true;
      const rows = document.querySelectorAll('.route-row');
      rows.forEach((r, i) => {
        setTimeout(() => {
          r.style.animation = `slideRight 0.4s ease forwards`;
          r.style.opacity = '1';
          r.style.transform = 'translateX(0)';
        }, 400 + i * 250);
      });

      setTimeout(() => {
        const flow = document.getElementById('routeFlow');
        animateEl(flow, 0, 'fadeInUp', 500);
      }, 2500);
    }, 4000);
  }, 18000);

  // === SCENE 3b: Algorithm (35-43s) ===
  setTimeout(() => {
    showScene('scene3b');
    showRouteAnim = false;
    routeAnimProgress = 0;

    const title = document.querySelector('#scene3b .algo-title');
    const sub = document.querySelector('#scene3b .algo-subtitle');
    const grid = document.querySelector('#scene3b .algo-grid');
    animateEl(title, 300, 'fadeInUp', 600);
    animateEl(sub, 800, 'fadeInUp', 600);
    animateEl(grid, 1500, 'scaleIn', 700);
  }, 35000);

  // === SCENE 4: Future (43-53s) ===
  setTimeout(() => {
    showScene('scene4');
    const fTitle = document.querySelector('.future-title');
    const fSub = document.querySelector('.future-sub');
    const agGrid = document.querySelector('.agent-grid');
    const botFlow = document.getElementById('botFlow');

    animateEl(fTitle, 300, 'fadeInUp', 700);
    animateEl(fSub, 1000, 'fadeInUp', 600);
    animateEl(agGrid, 2000, 'scaleIn', 700);
    animateEl(botFlow, 4500, 'fadeInUp', 600);
  }, 43000);

  // === SCENE 5: Closing (53-60s) ===
  setTimeout(() => {
    showScene('scene5');
    const logo = document.querySelector('.closing-logo');
    const tagline = document.querySelector('.closing-tagline');
    const stats = document.querySelector('.closing-stats');
    const url = document.querySelector('.closing-url');

    animateEl(logo, 300, 'scaleIn', 800);
    animateEl(tagline, 1200, 'fadeInUp', 600);
    animateEl(stats, 2200, 'fadeInUp', 600);
    animateEl(url, 3200, 'fadeIn', 600);
  }, 53000);

  // Progress bar + timer
  function updateProgress() {
    const t = getTime();
    const pct = Math.min((t / TOTAL_DURATION) * 100, 100);
    document.getElementById('progress').style.width = pct + '%';
    const sec = Math.floor(t / 1000);
    document.getElementById('timer').textContent = `${String(Math.floor(sec / 60)).padStart(2, '0')}:${String(sec % 60).padStart(2, '0')} / 1:00`;
    if (t < TOTAL_DURATION) requestAnimationFrame(updateProgress);
  }
  updateProgress();
}

// Start
renderCanvas();
setTimeout(runTimeline, 500);
</script>
</body>
</html>
